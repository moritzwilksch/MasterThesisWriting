\section{Methodology}
% =======================================================================
\subsection{Data Collection}
% -----------------------------------------------------------------------
\subsubsection{Data Sources}
English-speaking users who discuss finance and investing on online social media platforms in text form do so on three major platforms: Reddit, StockTwits, and Twitter. Reddit is a SNS on which users can create their own communities (``subreddits'') that focus on a specific topic. For example, users have created the subreddits ``Investing'' and ``StockMarket'' to discuss long-term investments and the subreddit ``WallStreetBets'' for posts about high-risk short-term gambles in the market. However, posts on Reddit tend to be much longer than posts on Twitter or StockTwits. Their length would require them to be analyzed on a paragraph- or sentence basis. Since research on SA is mostly focused on document-level analysis, we will not use Reddit posts for this work. The decision between StockTwits and Twitter is harder: posts on both platforms are similar in length and share the usage of cashtags (a ``\$'' sign followed by a ticker symbol) for identifying stocks. We decide to obtain data from Twitter rather than StockTwits for the following reasons:
\begin{enumerate}[noitemsep]
	\item The post volume on Twitter is higher than it is on StockTwits.
	\item The few data sets for SA on financial SM posts that exist use data from StockTwits, hence publishing a data set of tweets provides more value to the research community.
	\item By using Twitter data for our experiments we can answer RQ4 and compare performances between models and data sources.
\end{enumerate}

A disadvantage of the Twitter platform is that -- unlike StockTwits -- the majority of tweets are not related to finance and investing. As a remedy, we utilize cashtags for searching investment-related posts on Twitter. These tags are only used when referring to publicly traded companies as financial entities, as each cashtag contains the company's stock ticker symbol. This mostly prevents generic tweets about a company's brand or products from spilling into the collected data and allows us to focus the artifact design process on financial social media posts.

% -----------------------------------------------------------------------
\subsubsection{Sampling}

The first step to collecting data on Twitter is assembling a search query because the Twitter search application programming interface (API) requires users to search for specific cashtags instead of any tweet containing cashtags. To make results comparable to the previous literature we will focus on English posts only. Therefore, we use the S\&P500 index as a starting point for selecting ticker symbols to include in the search query. From there, we impose a minimum activity filter on each stock ticker: a ticker is only considered to be actively discussed on Twitter if there are more than 100 tweets per day on average mentioning it. We impose this filter because financial SA is only a valuable tool when applied to larger corpora of data. It should not be used when low post volume creates the risk of mistaking the opinion of very few people as the ``public'' sentiment. Therefore, by using an activity filter, we ensure that the tweets that are being collected are sampled from active discussions which make the training data more closely resemble the data that the SA models will be applied to at inference time. To conduct the filtering, we collect data on the number of tweets per day for every S\&P500 ticker during April of 2022. As Figure \ref{figure-tweet-activity} demonstrates, the distribution of activity is highly skewed. The top 20 tickers account for 53.7\% of all tweets about S\&P500 companies. According to the April 2022 data, 56 tickers fulfill the minimum activity constraint and account for 70.9\% of tweet volume. Out of these 56, we manually exclude 6 tickers (\texttt{AME, OGN, TEL, AMP, KEY, STX}) because while they represent corporations listed in the S\&P500 index, they are mostly used to reference cryptocurrencies on Twitter. This is problematic as the domain of cryptocurrencies is fundamentally different from the equity markets. Financial instruments like options do not exist for cryptocurrencies and they are also not affected by any kind of fundamental information. Thus, we decide to remove them from the data set and focus on publicly traded companies. This leaves 50 tickers to be included in the final Twitter API query.

\begin{figure}[!ht]
	\includegraphics[width=\textwidth]{assets/images/tweet_counts.pdf}
	\caption{Number of average tweets per day in April 2022 for the top 20 tickers}
	\label{figure-tweet-activity}
\end{figure}

The final API query is displayed in Figure \ref{figure-api-query}. The search retrieves all tweets mentioning any of the 50 tickers. Additionally, five options make the query 1) only retrieve English tweets, 2) exclude retweets because they do not contain original text, 3) exclude advertisements, 4) exclude tweets with images, and 5) exclude tweets with attached videos. We choose to exclude tweets with attached images or videos because we cannot analyze the information in the attached media. While most attachments are non-informative memes anyways, some include screenshots of stock charts or trading setups. Such images contain valuable information, but extracting it is beyond the scope of this work, which focuses on NLP.

Using the final search query, we collect all tweets using the Twitter API v2's endpoint \texttt{/2/tweets/search/all}. We query all tweets posted after April 1, 2021 (00:00:00 UTC) and before May 1, 2022 (00:00:00 UTC). By collecting a little more than one full year's worth of tweets we cover one full business cycle and prevent the collected data from being biased towards a small window of time, for example, earnings season. However, we have to acknowledge that market conditions and consequently Twitter discussions change over time. Therefore, the data sample from 2021/2022 might lose relevance in the long term.

\begin{figure}[!ht]
	\begin{tcolorbox}
	\small
	\centering
\texttt{(\$TSLA OR \$TWTR OR \$AAPL OR \$NFLX OR \$FB OR \$AMZN OR \$GM OR \$AMD OR \$NVDA OR \$MSFT OR \$DIS OR \$GOOGL OR \$F OR \$GOOG OR \$PYPL OR \$CAT OR \$T OR \$CVX OR \$BAC OR \$AAL OR \$BA OR \$PFE OR \$INTC OR \$JPM OR \$OXY OR \$ES OR \$WMT OR \$UAL OR \$DAL OR \$C OR \$KO OR \$XOM OR \$COST OR \$CCL OR \$MRNA OR \$MU OR \$GS OR \$WFC OR \$QCOM OR \$JNJ OR \$MS OR \$CRM OR \$SBUX OR \$VZ OR \$ABBV OR \$V OR \$MMM OR \$WBD OR \$NCLH OR \$PG) lang:en -is:retweet -is:nullcast -has:images -has:videos}
	\end{tcolorbox}
	\caption{Twitter API query used for data collection}
	\label{figure-api-query}
\end{figure}

The presented query yields XXX TBD results...

% =======================================================================
\subsection{Data Labelling}

% -----------------------------------------------------------------------
\subsubsection{Task Definition}
\begin{itemize}[noitemsep]
	\item Difference Market Sentiment vs. Writer Sentiment (see FinSoMe, chen et al):
\end{itemize}

\input{assets/tables/static/codebook.tex}


% -----------------------------------------------------------------------
\subsubsection{Data Quality Assessment}  % TODO: wording
\begin{itemize}[noitemsep]
	\item de-dupe
	\item length/cashtag filter
	\item potentially: spam classifier model?
	\item mention: no active learning (\url{https://blog.fastforwardlabs.com/2019/04/02/a-guide-to-learning-with-limited-labeled-data.html})
\end{itemize}




% =======================================================================
\subsection{Data Preprocessing}
\label{section-data-preprocessing}
% -----------------------------------------------------------------------
\subsubsection{Tokenization}
\begin{itemize}[noitemsep]
	\item tokenization
\end{itemize}

% -----------------------------------------------------------------------
\subsubsection{Representation of Text Data}
\begin{itemize}[noitemsep]
	\item vectorizer (TF-IDF?)
	\item Embeddings?
\end{itemize}






% =======================================================================
\subsection{Experiment Design}

%todo: this needs a section for descriptive experiments like bias check and sample tweets demo

% -----------------------------------------------------------------------
\subsubsection{Performance Evaluation}
\begin{itemize}[noitemsep]
	\item cross validation
	\item metrics
\end{itemize}


\input{assets/tikz_figures/cv.tex}


% -----------------------------------------------------------------------
\subsubsection{Selection of Models}


Models to build:

\input{assets/tables/static/models_to_build.tex}



\begin{itemize}[noitemsep]
	\item model types
	\item hyperparameters
\end{itemize}

% -----------------------------------------------------------------------
\subsubsection{Hyperparameters/Search Space?}


\textbf{Finally:} Show a flowchart of everything?






